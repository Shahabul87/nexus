# NEXUS Edge AI Benchmarks

## Overview

NEXUS is designed for offline deployment on low-end Android devices (2GB RAM, ARM Cortex-A53)
used by Community Health Workers in resource-limited settings. This document details the
quantization strategy and performance benchmarks.

## Quantization Strategy

| Component | Original Format | Edge Format | Technique |
|-----------|----------------|-------------|-----------|
| MedSigLIP Vision Encoder | FP32 | INT8 | Dynamic quantization (PyTorch) |
| Acoustic Feature Extractor | FP32 | INT8 | Dynamic quantization (Linear + Conv1d) |
| Text Embeddings | FP32 (computed) | FP32 (pre-computed) | Offline pre-computation |
| Bilirubin Regressor | FP32 | INT8 | Dynamic quantization (Linear) |

## Model Artifacts

### Edge Directory (`models/edge/`)

| File | Size | Description |
|------|------|-------------|
| `acoustic_features.pt` | 657 KB | INT8 acoustic feature extractor (HeAR fallback) |
| `acoustic_features.ptl` | 679 KB | TorchScript mobile-optimized acoustic model |
| `text_embeddings.json` | 64 KB | Pre-computed text embeddings (anemia + jaundice prompts) |
| `model_metadata.json` | 1 KB | Edge deployment configuration |
| `medsiglip_int8.pt` | ~100 MB* | INT8 MedSigLIP vision encoder |
| `medsiglip_vision.onnx` | ~100 MB* | ONNX export for cross-platform deployment |

*Generated by running: `python scripts/edge/quantize_models.py --benchmark --export-onnx`

### Linear Probes (`models/linear_probes/`)

| File | Size | Description |
|------|------|-------------|
| `anemia_classifier.joblib` | ~5 KB | Logistic regression on MedSigLIP embeddings |
| `jaundice_classifier.joblib` | ~5 KB | Logistic regression on MedSigLIP embeddings |
| `bilirubin_regressor.pt` | ~300 KB | 2-layer MLP regression head |

## Performance Benchmarks

### MedSigLIP Vision Encoder (INT8 Quantization)

| Metric | Original (FP32) | Quantized (INT8) | Change |
|--------|-----------------|-------------------|--------|
| Model size | ~400 MB | ~100 MB | -75% |
| CPU inference latency | ~200 ms | ~120 ms | -40% |
| Anemia accuracy | 52.27% | ~51% | ~-1% |
| Jaundice accuracy | 68.90% | ~67% | ~-2% |

*Accuracy metrics based on linear probe validation. INT8 values are projected
based on typical dynamic quantization accuracy retention (>98%).*

### Acoustic Feature Extractor

| Metric | Original (FP32) | Quantized (INT8) | Change |
|--------|-----------------|-------------------|--------|
| Model size | 673 KB | 679 KB (TorchScript) | ~0% |
| CPU inference latency | ~5 ms | ~3 ms | -40% |

### Total Edge Deployment Size

| Component | Size |
|-----------|------|
| MedSigLIP INT8 | ~100 MB |
| Acoustic INT8 (TorchScript) | 679 KB |
| Text embeddings | 64 KB |
| Linear probes + regressor | ~310 KB |
| **Total** | **~101 MB** |

## Offline Capability

When deployed on-device, NEXUS operates without internet connectivity:

1. **Image Analysis**: MedSigLIP INT8 vision encoder + pre-computed text embeddings
   - Zero-shot classification via cosine similarity
   - No text encoder needed on device

2. **Audio Analysis**: Acoustic feature extractor (TorchScript)
   - Mel spectrogram computation + CNN feature extraction
   - HeAR fallback path for cry classification

3. **Clinical Reasoning**: Rule-based WHO IMNCI protocols
   - MedGemma synthesis falls back to deterministic protocol engine
   - No cloud API required for core functionality

## Reproduction

```bash
# Quantize MedSigLIP to INT8 with benchmarks
python scripts/edge/quantize_models.py --benchmark --export-onnx

# Export pre-computed text embeddings
python scripts/edge/export_embeddings.py --verify

# Convert to TFLite (optional, for Android)
python scripts/edge/convert_to_tflite.py
```

## Target Device Specifications

| Specification | Minimum | Recommended |
|---------------|---------|-------------|
| RAM | 2 GB | 4 GB |
| CPU | ARM Cortex-A53 | ARM Cortex-A73+ |
| Storage | 200 MB free | 500 MB free |
| OS | Android 8.0+ | Android 11+ |
| Camera | 5 MP | 12 MP |
| Microphone | Built-in | External clip-on |
