# NEXUS Edge AI Benchmarks

## Overview

NEXUS is designed for offline deployment on low-end Android devices (2GB RAM, ARM Cortex-A53)
used by Community Health Workers in resource-limited settings. This document details the
quantization strategy and performance benchmarks.

## Quantization Strategy

| Component | Original Format | Edge Format | Technique |
|-----------|----------------|-------------|-----------|
| MedSigLIP Vision Encoder | FP32 | INT8 | Dynamic quantization (PyTorch) |
| Acoustic Feature Extractor | FP32 | INT8 | Dynamic quantization (Linear + Conv1d) |
| Text Embeddings | FP32 (computed) | FP32 (pre-computed) | Offline pre-computation |
| Bilirubin Regressor | FP32 | INT8 | Dynamic quantization (Linear) |

## Model Artifacts

### Edge Directory (`models/edge/`)

| File | Size | Description |
|------|------|-------------|
| `medsiglip_int8.pt` | 287.4 MB | INT8 MedSigLIP vision encoder |
| `acoustic_int8.pt` | 0.6 MB | INT8 acoustic feature extractor (HeAR fallback) |
| `acoustic_features.pt` | 0.7 MB | Original acoustic feature extractor |
| `acoustic_features.ptl` | 0.7 MB | TorchScript mobile-optimized acoustic model |
| `text_embeddings.json` | 64 KB | Pre-computed text embeddings (JSON format) |
| `embeddings/*.bin` | 12 KB | Pre-computed binary embeddings (4 categories, 768-dim) |
| `model_metadata.json` | 1 KB | Edge deployment configuration |
| `quantization_results.json` | 1 KB | Benchmark results |

Generated by running: `python scripts/edge/quantize_models.py --benchmark`

### Linear Probes (`models/linear_probes/`)

| File | Size | Description |
|------|------|-------------|
| `anemia_classifier.joblib` | ~5 KB | Logistic regression on MedSigLIP embeddings |
| `jaundice_classifier.joblib` | ~5 KB | Logistic regression on MedSigLIP embeddings |
| `bilirubin_regressor.pt` | ~300 KB | 2-layer MLP regression head |

## Performance Benchmarks

### MedSigLIP Vision Encoder (INT8 Quantization)

| Metric | Original (FP32) | Quantized (INT8) | Change |
|--------|-----------------|-------------------|--------|
| Model size (memory) | 812.6 MB | 111.2 MB | **-86.3%** |
| Model size (disk) | ~813 MB | 287.4 MB | **-64.6%** |
| Compression ratio | - | 7.31x | - |
| CPU latency (macOS) | 97.68 ms | 111.19 ms | +13.8%* |
| Anemia accuracy | 52.27% | ~51% | ~-1% |
| Jaundice accuracy | 68.90% | ~67% | ~-2% |

*Note: On macOS (qnnpack backend), INT8 is slightly slower due to non-native
quantization support. On ARM Android (which uses optimized INT8 NEON instructions),
INT8 inference is expected to be 1.5-3x faster than FP32.*

*Accuracy metrics based on linear probe validation. INT8 values projected
from typical dynamic quantization accuracy retention (>98%).*

### Acoustic Feature Extractor

| Metric | Original (FP32) | Quantized (INT8) | Change |
|--------|-----------------|-------------------|--------|
| Model size | 0.665 MB | 0.599 MB | -9.9% |
| Compression ratio | - | 1.11x | - |
| TorchScript model | - | 0.7 MB | Mobile-optimized |

### Total Edge Deployment Size

| Component | Size |
|-----------|------|
| MedSigLIP INT8 | 287.4 MB |
| Acoustic INT8 | 0.6 MB |
| Text embeddings (binary) | 12 KB |
| Linear probes + regressor | ~310 KB |
| Metadata | ~2 KB |
| **Total** | **~289 MB** |

## Offline Capability

When deployed on-device, NEXUS operates without internet connectivity:

1. **Image Analysis**: MedSigLIP INT8 vision encoder + pre-computed text embeddings
   - Zero-shot classification via cosine similarity
   - No text encoder needed on device

2. **Audio Analysis**: Acoustic feature extractor (TorchScript)
   - Mel spectrogram computation + CNN feature extraction
   - HeAR fallback path for cry classification

3. **Clinical Reasoning**: Rule-based WHO IMNCI protocols
   - MedGemma synthesis falls back to deterministic protocol engine
   - No cloud API required for core functionality

## Reproduction

```bash
# Quantize MedSigLIP to INT8 with benchmarks
python scripts/edge/quantize_models.py --benchmark --export-onnx

# Export pre-computed text embeddings
python scripts/edge/export_embeddings.py --verify

# Convert to TFLite (optional, for Android)
python scripts/edge/convert_to_tflite.py
```

## Target Device Specifications

| Specification | Minimum | Recommended |
|---------------|---------|-------------|
| RAM | 2 GB | 4 GB |
| CPU | ARM Cortex-A53 | ARM Cortex-A73+ |
| Storage | 200 MB free | 500 MB free |
| OS | Android 8.0+ | Android 11+ |
| Camera | 5 MP | 12 MP |
| Microphone | Built-in | External clip-on |
